{
  "extractor_name": "SCTExtractor",
  "extractor_description": "Summary Compensation Table extractor",
  "domain": "sct",
  "data_model_import": "from ..models.sct_models import SCTData, SCTExtractionResult, ExecutiveCompensation, CompensationYear",
  "data_model_class": "SCTData",
  "result_class": "SCTExtractionResult",

  "rate_limit_delay": 0.15,
  "context_chars": 1000,
  "max_html_size": 100000,

  "heading_patterns": [
    "[IVX]+\\.\\s*SUMMARY COMPENSATION TABLE",
    "Summary Compensation Table[—\\-–]\\s*20\\d{2}",
    "(?<!Advisory Vote to Approve )Summary Compensation Table(?!\\s*Proposal)",
    "(?<!Advisory Vote to Approve )Named Executive Officer.*Compensation",
    "Executive [Cc]ompensation [Tt]ables",
    "(?<!Advisory Vote to Approve )SUMMARY COMPENSATION TABLE"
  ],

  "table_validation_rules": {
    "required_columns": ["name", "year", "salary"],
    "reject_patterns": [
      "grant date",
      "fees earned",
      "director compensation"
    ]
  },

  "llm_temperature": 0.1,
  "llm_max_tokens": 8000,
  "system_prompt": "You are an expert at extracting structured data from SEC filings. Extract executive compensation data following the provided schema exactly.",

  "models": [
    {
      "name": "CompensationYear",
      "description": "Compensation data for a single fiscal year",
      "notes": "Represents one row in the Summary Compensation Table for an executive.\nAll monetary values are in USD (integer, no decimals).",
      "fields": [
        {
          "name": "year",
          "type": "int",
          "description": "Fiscal year",
          "required": true,
          "ge": 2000,
          "le": 2100
        },
        {
          "name": "salary",
          "type": "int",
          "description": "Base salary ($)",
          "required": false,
          "default": 0,
          "ge": 0
        },
        {
          "name": "bonus",
          "type": "int",
          "description": "Annual bonus ($)",
          "required": false,
          "default": 0,
          "ge": 0
        },
        {
          "name": "stock_awards",
          "type": "int",
          "description": "Stock awards ($)",
          "required": false,
          "default": 0,
          "ge": 0
        },
        {
          "name": "total",
          "type": "int",
          "description": "Total compensation ($)",
          "required": true,
          "ge": 0
        }
      ],
      "validators": [
        {
          "name": "validate_total",
          "field": "total",
          "type": "int",
          "description": "Validate that total equals sum of components",
          "code": "if not info.data:\n    return v\n\ncalculated_total = (\n    info.data.get('salary', 0) +\n    info.data.get('bonus', 0) +\n    info.data.get('stock_awards', 0)\n)\n\nif abs(v - calculated_total) > 1:\n    raise ValueError(\n        f\"Total mismatch: expected {calculated_total}, got {v}\"\n    )\n\nreturn v"
        }
      ]
    },
    {
      "name": "ExecutiveCompensation",
      "description": "Named Executive Officer with multi-year compensation data",
      "fields": [
        {
          "name": "name",
          "type": "str",
          "description": "Executive full name",
          "required": true
        },
        {
          "name": "position",
          "type": "str",
          "description": "Executive title/position",
          "required": true
        },
        {
          "name": "is_ceo",
          "type": "bool",
          "description": "True if CEO or Principal Executive Officer",
          "required": false,
          "default": false
        },
        {
          "name": "compensation_by_year",
          "type": "List[CompensationYear]",
          "description": "Compensation data for each fiscal year",
          "required": true,
          "min_length": 1,
          "max_length": 3
        }
      ]
    },
    {
      "name": "SCTData",
      "description": "Complete Summary Compensation Table from DEF 14A proxy filing",
      "is_main_model": true,
      "fields": [
        {
          "name": "company_name",
          "type": "str",
          "description": "Company legal name",
          "required": true
        },
        {
          "name": "ticker",
          "type": "str",
          "description": "Stock ticker symbol",
          "required": true,
          "pattern": "^[A-Z]{1,5}$"
        },
        {
          "name": "cik",
          "type": "str",
          "description": "SEC Central Index Key (10 digits)",
          "required": true,
          "pattern": "^[0-9]{10}$"
        },
        {
          "name": "executives",
          "type": "List[ExecutiveCompensation]",
          "description": "Named Executive Officers (typically 5)",
          "required": true,
          "min_length": 1,
          "max_length": 10
        }
      ],
      "methods": [
        {
          "name": "get_ceo",
          "description": "Get CEO/Principal Executive Officer.",
          "params": [],
          "return_type": "Optional[ExecutiveCompensation]",
          "code": "for exec in self.executives:\n    if exec.is_ceo:\n        return exec\nreturn None"
        }
      ]
    }
  ],

  "result_model": {
    "name": "SCTExtractionResult",
    "data_class": "SCTData"
  },

  "task_description": "Extract executive compensation data from Summary Compensation Table",
  "task_instructions": "Extract executive compensation data from the Summary Compensation Table (SCT) in the HTML below.\n\nThe SCT typically contains:\n- **5 Named Executive Officers (NEOs)**\n- **3 fiscal years** of data per executive\n- Standard compensation columns: Salary, Stock Awards, Total",

  "parsing_rules": [
    {
      "title": "Rowspan Handling (IMPORTANT!)",
      "description": "When you see `rowspan=\"3\"` on a name/position cell:\n- That executive name applies to the **next 3 rows**\n- Each row is a different fiscal year (e.g., 2024, 2023, 2022)\n- Extract all 3 years as separate entries in `compensation_by_year` array",
      "examples": [
        "rowspan=\"3\" means name applies to next 3 rows",
        "Each row is a separate fiscal year entry"
      ]
    },
    {
      "title": "Empty Cells",
      "description": "- Cells containing only `&#160;`, `&nbsp;`, or whitespace = **$0**\n- Missing columns (e.g., no \"Bonus\" column) = **default to 0**"
    },
    {
      "title": "Currency Conversion",
      "description": "- Convert `\"3,000,000\"` to integer `3000000`\n- Remove commas, dollar signs, decimals\n- All monetary values must be integers"
    }
  ],

  "example_input": "<tr>\n  <td rowspan=\"3\"><b>Tim Cook</b><br/>CEO</td>\n  <td>2024</td><td>3,000,000</td><td>58,088,946</td><td>74,609,802</td>\n</tr>",

  "example_output": {
    "name": "Tim Cook",
    "position": "Chief Executive Officer",
    "is_ceo": true,
    "compensation_by_year": [
      {
        "year": 2024,
        "salary": 3000000,
        "bonus": 0,
        "stock_awards": 58088946,
        "total": 74609802
      }
    ]
  },

  "example_explanation": "- `rowspan=\"3\"` means Tim Cook appears in next 3 rows (2024, 2023, 2022)\n- Empty cells = $0 for Bonus\n- Position \"Chief Executive Officer\" → `is_ceo: true`",

  "json_schema": {
    "company_name": "string",
    "ticker": "string (1-5 uppercase letters)",
    "cik": "string (10 digits)",
    "executives": [
      {
        "name": "string",
        "position": "string",
        "is_ceo": "boolean",
        "compensation_by_year": [
          {
            "year": "integer",
            "salary": "integer",
            "bonus": "integer",
            "stock_awards": "integer",
            "total": "integer"
          }
        ]
      }
    ]
  },

  "output_requirements": [
    "Return **ONLY** valid JSON (no markdown code fences, no explanations)",
    "Extract **ALL executives** from the table (typically 5)",
    "Each executive must have **1-3 years** of compensation data",
    "Use proper JSON syntax: double quotes, lowercase booleans (`true`/`false`)"
  ],

  "test_fixtures": [
    {
      "name": "sample_sct_html",
      "description": "Sample SCT HTML for testing",
      "data": {
        "html": "<table><tr><th>Name</th><th>Year</th><th>Salary</th></tr></table>"
      }
    }
  ],

  "test_cases": [
    {
      "name": "extraction_success",
      "description": "Test successful extraction with valid data",
      "fixtures": ["extractor", "mock_openrouter"],
      "filing_url": "https://www.sec.gov/test",
      "cik": "0000320193",
      "company_name": "Apple Inc.",
      "ticker": "AAPL",
      "expected_success": true,
      "mock_responses": [
        {
          "target": "mock_openrouter.chat_completion_json",
          "value": "{\"company_name\": \"Apple Inc.\", \"ticker\": \"AAPL\", \"cik\": \"0000320193\", \"executives\": []}"
        }
      ]
    }
  ]
}
